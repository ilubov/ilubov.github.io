

<!DOCTYPE html>
<html lang="en">
<!--begin head-->

<head>
    <meta charset="utf-8">
<!--begin title-->

<title>
    
    Transactional |
    
    ilubov</title>
<!--end title-->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<!--begin mete-->

<meta name="description" content="Get busy living or get busy dying."/>

<meta name="author" content="ilubov"/>

<!--end mete-->
<!--begin keywords-->
<meta name="keywords" content="IO,github,google,guava,hexo,java,jvm,linux,mybatis,mysql,nginx,redis,sharding jdbc,spring,spring cloud,并发,支付,数据库,服务器,设计模式,集合"/>
<!--end keywords-->
<!--begin rss-->

<!--end rss-->
<!--begin favicon-->

<link rel="icon" href="/favicon.ico">

<!--end favicon-->
<!--begin style-->

<!-- stylesheets list from config.yml -->

<link rel="stylesheet" href="/css/hannah.css">


<!--end style-->
<meta name="generator" content="Hexo 5.0.2"></head>
<!--end head-->
<!--begin body-->

<body class="container-fluid">

    <!--begin menu-->
    <div class="hannah-menu">
    <i class="fh fh-ravelry fa-2x btn fixed-menu animated bounce" id="btn_menu" aria-hidden="true"></i>
    <div class="menu-outer container-fluid hide animated" id="div_menu">
        <div class="row" style="margin-bottom: 5px;">
            
            <div class="col-md-offset-2 col-md-3 col-xs-4 text-center left-social">
                
                <a target="_blank" href="https://github.com/ilubov" title="GitHub"><i class="fh fh-github"></i></a>
                
                <style>
                    .left-social {
                        height: 132px;
                        line-height: 132px;
                        font-size: 66px;
                    }

                    .left-social * {
                        color: #f1ce8e;
                    }

                    @media (max-width: 767px) {
                        .left-social {
                            line-height: 132px;
                            font-size: 33px;
                        }
                    }
                </style>
            </div>
            <!--begin handImg-->
            <div class="col-md-2 col-xs-4 text-center">
                
                <img src="/img/logo.jpg" alt="Head Image" class="img-circle">
                
            </div>
            <!--end handImg-->
            <div class="col-md-3 col-xs-4 text-center right-social">
                
                <style>
                    .right-social {
                        height: 132px;
                        line-height: 132px;
                        font-size: 66px;
                    }

                    @media (max-width: 767px) {
                        .right-social {
                            line-height: 132px;
                            font-size: 33px;
                        }
                    }

                    .right-social * {
                        color: #f1ce8e;
                    }
                </style>
            </div>
        </div>
        <div class="row">
            <div class="menu-content col-md-8 col-md-push-2 col-xs-12 ">
                <dl class="menu-content-item">
                    <dt class="menu-content-title">
                        <i class="fh fh-bars" aria-hidden="true"></i> Menu
                    </dt>
                    <dd class="menu-content-content">
                        
                        <div class="col-md-4 col-xs-6 col-sm-4 text-center animated tada">
                            <a href="/" class="btn btn-block">
                                
                                <i class="fh fh-ravelry"></i>
                                Home
                            </a>
                        </div>
                        
                        <div class="col-md-4 col-xs-6 col-sm-4 text-center animated tada">
                            <a href="/categories/index.html" class="btn btn-block">
                                
                                <i class="fh fh-cubes"></i>
                                Category
                            </a>
                        </div>
                        
                        <div class="col-md-4 col-xs-6 col-sm-4 text-center animated tada">
                            <a href="/tags/index.html" class="btn btn-block">
                                
                                <i class="fh fh-tags"></i>
                                Tag
                            </a>
                        </div>
                        
                        <div class="col-md-4 col-xs-6 col-sm-4 text-center animated tada">
                            <a target="_blank" rel="noopener" href="https://www.ilubov.cn" class="btn btn-block">
                                
                                <i class="fh fh-about"></i>
                                About
                            </a>
                        </div>
                        
                        <div class="col-md-4 col-xs-6 col-sm-4 text-center animated tada">
                            <a href="" class="btn btn-block">
                                <i class="fh fh-rss" aria-hidden="true"></i> RSS
                            </a>
                        </div>
                    </dd>
                </dl>
            </div>
        </div>
        <div class="row">
            <div class="menu-content col-md-8 col-md-offset-2 col-xs-12 ">
                <dl class="col-md-6 col-xs-6 menu-content-item">
                    <dt class="menu-content-title">
                        <i class="fh fh-cubes" aria-hidden="true"></i> Category
                    </dt>
                    <dd class="menu-content-content animated zoomIn">
                        <ul class="menu-cate-list"><li class="menu-cate-list-item"><a class="menu-cate-list-link" href="/categories/hexo/"><i class="fh fh-cube" aria-hidden="true"></i> hexo</a><span class="menu-cate-list-count">1</span></li><li class="menu-cate-list-item"><a class="menu-cate-list-link" href="/categories/java/"><i class="fh fh-cube" aria-hidden="true"></i> java</a><span class="menu-cate-list-count">23</span></li><li class="menu-cate-list-item"><a class="menu-cate-list-link" href="/categories/nginx/"><i class="fh fh-cube" aria-hidden="true"></i> nginx</a><span class="menu-cate-list-count">1</span></li><li class="menu-cate-list-item"><a class="menu-cate-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"><i class="fh fh-cube" aria-hidden="true"></i> 数据库</a><span class="menu-cate-list-count">7</span></li><li class="menu-cate-list-item"><a class="menu-cate-list-link" href="/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8/"><i class="fh fh-cube" aria-hidden="true"></i> 服务器</a><span class="menu-cate-list-count">1</span></li></ul>
                    </dd>
                </dl>
                <dl class="col-md-6 col-xs-6 menu-content-item">
                    <dt class="menu-content-title">
                        <i class="fh fh-tag" aria-hidden="true"></i> Tags
                    </dt>
                    <dd class="menu-content-content animated zoomIn">
                        <ul class="menu-tag-list" itemprop="keywords"><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/IO/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> IO</a><span class="menu-tag-list-count">1</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/github/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> github</a><span class="menu-tag-list-count">1</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/google/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> google</a><span class="menu-tag-list-count">1</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/guava/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> guava</a><span class="menu-tag-list-count">1</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/hexo/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> hexo</a><span class="menu-tag-list-count">1</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/java/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> java</a><span class="menu-tag-list-count">23</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/jvm/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> jvm</a><span class="menu-tag-list-count">1</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/linux/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> linux</a><span class="menu-tag-list-count">1</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/mybatis/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> mybatis</a><span class="menu-tag-list-count">1</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/mysql/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> mysql</a><span class="menu-tag-list-count">4</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/nginx/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> nginx</a><span class="menu-tag-list-count">1</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/redis/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> redis</a><span class="menu-tag-list-count">2</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/sharding-jdbc/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> sharding jdbc</a><span class="menu-tag-list-count">1</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/spring/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> spring</a><span class="menu-tag-list-count">1</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/spring-cloud/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> spring cloud</a><span class="menu-tag-list-count">1</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/%E5%B9%B6%E5%8F%91/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> 并发</a><span class="menu-tag-list-count">1</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/%E6%94%AF%E4%BB%98/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> 支付</a><span class="menu-tag-list-count">2</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> 数据库</a><span class="menu-tag-list-count">7</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> 服务器</a><span class="menu-tag-list-count">1</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> 设计模式</a><span class="menu-tag-list-count">1</span></li><li class="menu-tag-list-item"><a class="menu-tag-list-link" href="/tags/%E9%9B%86%E5%90%88/" rel="tag"><i class="fh fh-tag" aria-hidden="true"></i> 集合</a><span class="menu-tag-list-count">1</span></li></ul>
                    </dd>
                </dl>
            </div>
        </div>
    </div>
</div>
    <!--end menu-->

    <div class="row hannah-body">
        <div class="col-md-8 col-md-push-2 col-xs-12">
            <!--begin breadcrumb-->
            <div class="bread-crumb">
    <ul class="bread-crumb-menu animated rubberBand">
        <li><a href="/"><i class="fh fh-ravelry" aria-hidden="true"></i> Home</a></li>
        
        <li><a href="/categories/java/"><i class="fh fh-cube" aria-hidden="true"></i> java</a>
        </li>
        
        <li>
            
            <i class="fh fh-newspaper-o" aria-hidden="true"></i>
            
            Transactional
        </li>
        
    </ul>
    <div class="bread-crumb-search">
        <div class="search">
    <i class="fh fh-search icon-search"></i>
    <input placeholder="Search ..." onkeyup="searchFunc(this,event,'/search.xml')"
           class="input-search animated fadeInRight"/>
    <div class="search-result animated fadeInRight">
        <a class="animated tada col-lg-12 search-result-item result-link" href="/2021/02/25/java-es/">StringBoot + ElasticSearch</a><a class="animated tada col-lg-12 search-result-item result-link" href="/2021/02/23/docker-es/">ElasticSearch</a><a class="animated tada col-lg-12 search-result-item result-link" href="/2021/02/22/java-hashmap/">HashMap</a><a class="animated tada col-lg-12 search-result-item result-link" href="/2021/02/20/java-youdao-translate/">有道翻译api</a><a class="animated tada col-lg-12 search-result-item result-link" href="/2021/01/24/java8-foreach/">可以break的forEach</a><a class="animated tada col-lg-12 search-result-item result-link" href="/2021/01/22/jet-cache/">JetCache</a><a class="animated tada col-lg-12 search-result-item result-link" href="/2021/01/18/caching-algorithm/">缓存算法</a><a class="animated tada col-lg-12 search-result-item result-link" href="/2021/01/17/work-wx-open-default-browser/">企业微信电脑客户端打开系统默认浏览器</a><a class="animated tada col-lg-12 search-result-item result-link" href="/2021/01/15/mybatis-second-level-cache/">mybatis-plus二级缓存</a><a class="animated tada col-lg-12 search-result-item result-link" href="/2021/01/02/java-try-with-resources/">try-with-resources语句</a><a class="animated tada col-lg-12 search-result-item result-link" href="/2020/12/06/nginx_google/">Nginx反向代理Google</a><a class="animated tada col-lg-12 search-result-item result-link" href="/2020/12/04/hexo-source-file-backup/">将hexo源文件备份到github</a><a class="animated tada col-lg-12 search-result-item result-link" href="/2020/11/13/mysql-function/">mysql使用函数递归查找父级或子级id</a><a class="animated tada col-lg-12 search-result-item result-link" href="/2020/11/12/java-xxl-job/">xxl job</a><a class="animated tada col-lg-12 search-result-item result-link" href="/2020/11/01/linux-custom-command/">Linux 创建自定义命令</a>
    </div>
</div>
    </div>
</div>
            <!--end breadcrumb-->
            <!--begin body-->
            <article class="post animated rollIn">
    <h1 class="post-title">Transactional</h1>
    <div class="post-subtitle">
        
        <time datetime="2020-02-20T15:33:10.000Z" class="item">
            <i class="fh fh-calendar" aria-hidden="true"></i>&nbsp;&nbsp;2020-02-20
        </time>
        
        
        <span class="item">
      <i class="fh fh-cubes" aria-hidden="true"></i>&nbsp;
            
            <a class="label label-primary tags" href="/categories/java/">
           <i class="fh fh-cube" aria-hidden="true"></i>&nbsp;java
        </a>
            
        </span>
        
        
        <span class="item">
        <i class="fh fh-tags" aria-hidden="true"></i>&nbsp;
            
            <a class="label label-info tags" href="/tags/java/">
            <i class="fh fh-tag" aria-hidden="true"></i>&nbsp;java
            </a>
            
            <a class="label label-info tags" href="/tags/spring/">
            <i class="fh fh-tag" aria-hidden="true"></i>&nbsp;spring
            </a>
            
        </span>
        
    </div>
    
    <h3 id="Transactional"><a href="#Transactional" class="headerlink" title="@Transactional"></a>@Transactional</h3><h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><p>Transactional是spring中定义的事务注解，在方法或类上加该注解开启事务。主要是通过反射获取bean的注解信息，利用AOP对编程式事务进行封装实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="comment">// 基于AOP的环绕通知和异常通知实现Spring事务</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopTransaction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MyTransaction myTransaction;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 环绕通知  在方法之前和之后处理事情</span></span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.wulei.service.UserService.add(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">around</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">// 开启事务    调用方法之前执行 </span></span><br><span class="line">        TransactionStatus transactionStatus = myTransaction.begin();</span><br><span class="line">        proceedingJoinPoint.proceed();<span class="comment">// 代理调用方法 注意点： 如果调用方法抛出溢出不会执行后面代码</span></span><br><span class="line">        <span class="comment">// 提交事务  调用方法之后执行</span></span><br><span class="line">        myTransaction.commit(transactionStatus);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 异常通知</span></span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;execution(* com.wulei.service.UserService.add(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;回滚当前事务&quot;</span>);</span><br><span class="line">        <span class="comment">// 获取当前事务 直接回滚</span></span><br><span class="line">        TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h4><p>1、service类标签(一般不建议在接口上)上添加@Transactional，可以将整个类纳入spring事务管理，在每个业务方法执行时都会开启一个事务，不过这些事务采用相同的管理方式。<br>2、@Transactional 注解只能应用到 public 可见度的方法上。 如果应用在protected、private或者 package可见度的方法上，也不会报错，不过事务设置不会起作用。<br>3、默认情况下，Spring会对unchecked异常进行事务回滚；如果是checked异常则不回滚。<br>辣么什么是checked异常，什么是unchecked异常<br>java里面将派生于Error或者RuntimeException（比如空指针，1/0）的异常称为unchecked异常，其他继承自java.lang.Exception得异常统称为Checked Exception，如IOException、TimeoutException等<br>辣么再通俗一点：你写代码出现的空指针等异常，会被回滚，文件读写，网络出问题，spring就没法回滚了。然后我教大家怎么记这个，因为很多同学容易弄混，你写代码的时候有些IOException我们的编译器是能够检测到的，说以叫checked异常，你写代码的时候空指针等死检测不到的，所以叫unchecked异常。这样是不是好记一些啦<br>4、只读事务：<br><code>@Transactional(propagation=Propagation.NOT_SUPPORTED,readOnly=true) </code><br>只读标志只在事务启动时应用，否则即使配置也会被忽略。<br>启动事务会增加线程开销，数据库因共享读取而锁定(具体跟数据库类型和事务隔离级别有关)。通常情况下，仅是读取数据时，不必设置只读事务而增加额外的系统开销。</p>
<h4 id="Transactional注解参数详解"><a href="#Transactional注解参数详解" class="headerlink" title="@Transactional注解参数详解"></a>@Transactional注解参数详解</h4><h5 id="参数一：事物传播行为-propagation"><a href="#参数一：事物传播行为-propagation" class="headerlink" title="参数一：事物传播行为 propagation"></a>参数一：事物传播行为 propagation</h5><ul>
<li>REQUIRED：支持当前事务，如果当前没有事务，就新建一个事务。这是最常见的选择。 </li>
<li>SUPPORTS：支持当前事务，如果当前没有事务，就以非事务方式执行。 </li>
<li>MANDATORY：支持当前事务，如果当前没有事务，就抛出异常。 </li>
<li>REQUIRES_NEW：新建事务，如果当前存在事务，把当前事务挂起。 </li>
<li>NOT_SUPPORTED：以非事务方式执行操作，如果当前存在事务，就把当前事务挂起。 </li>
<li>NEVER：以非事务方式执行，如果当前存在事务，则抛出异常。 </li>
<li>NESTED：支持当前事务，如果当前事务存在，则执行一个嵌套事务，如果当前没有事务，就新建一个事务。 </li>
</ul>
<h5 id="参数二：事物超时设置-timeout"><a href="#参数二：事物超时设置-timeout" class="headerlink" title="参数二：事物超时设置 timeout"></a>参数二：事物超时设置 timeout</h5><ul>
<li>timeout=30 默认是30秒</li>
</ul>
<h5 id="参数三：事务隔离级别-isolation"><a href="#参数三：事务隔离级别-isolation" class="headerlink" title="参数三：事务隔离级别 isolation"></a>参数三：事务隔离级别 isolation</h5><ul>
<li>Isolation.READ_UNCOMMITTED：读取未提交数据(会出现脏读, 不可重复读) 基本不使用</li>
<li>Isolation.READ_COMMITTED：读取已提交数据(会出现不可重复读和幻读)</li>
<li>Isolation.REPEATABLE_READ：可重复读(会出现幻读)</li>
<li>Isolation.SERIALIZABLE：串行化</li>
</ul>
<p>MYSQL：默认为REPEATABLE_READ级别<br>SQLSERVER：默认为READ_COMMITTED</p>
<h5 id="参数四：readOnly"><a href="#参数四：readOnly" class="headerlink" title="参数四：readOnly"></a>参数四：readOnly</h5><ul>
<li>属性用于设置当前事务是否为只读事务，设置为true表示只读，false则表示可读写，默认值为false。</li>
</ul>
<h5 id="参数五：rollbackFor"><a href="#参数五：rollbackFor" class="headerlink" title="参数五：rollbackFor"></a>参数五：rollbackFor</h5><ul>
<li>该属性用于设置需要进行回滚的异常类数组，当方法中抛出指定异常数组中的异常时，则进行事务回滚。例如：<ul>
<li>指定单一异常类：@Transactional(rollbackFor=RuntimeException.class)</li>
<li>指定多个异常类：@Transactional(rollbackFor={RuntimeException.class, Exception.class})</li>
</ul>
</li>
</ul>
<h5 id="参数六：rollbackForClassName"><a href="#参数六：rollbackForClassName" class="headerlink" title="参数六：rollbackForClassName"></a>参数六：rollbackForClassName</h5><ul>
<li>该属性用于设置需要进行回滚的异常类名称数组，当方法中抛出指定异常名称数组中的异常时，则进行事务回滚。例如：<ul>
<li>指定单一异常类名称：@Transactional(rollbackForClassName=”RuntimeException”)</li>
<li>指定多个异常类名称：@Transactional(rollbackForClassName={“RuntimeException”,”Exception”})</li>
</ul>
</li>
</ul>
<h5 id="参数七：noRollbackForClassName"><a href="#参数七：noRollbackForClassName" class="headerlink" title="参数七：noRollbackForClassName"></a>参数七：noRollbackForClassName</h5><ul>
<li>该属性用于设置不需要进行回滚的异常类名称数组，当方法中抛出指定异常名称数组中的异常时，不进行事务回滚。例如：<ul>
<li>指定单一异常类名称：@Transactional(noRollbackForClassName=”RuntimeException”)</li>
<li>指定多个异常类名称：@Transactional(noRollbackForClassName={“RuntimeException”,”Exception”})</li>
</ul>
</li>
</ul>
<h5 id="参数八：noRollbackFor"><a href="#参数八：noRollbackFor" class="headerlink" title="参数八：noRollbackFor"></a>参数八：noRollbackFor</h5><ul>
<li>该属性用于设置不需要进行回滚的异常类数组，当方法中抛出指定异常数组中的异常时，不进行事务回滚。例如：<ul>
<li>指定单一异常类：@Transactional(noRollbackFor=RuntimeException.class)</li>
<li>指定多个异常类：@Transactional(noRollbackFor={RuntimeException.class, Exception.class})</li>
</ul>
</li>
</ul>
<h4 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h4><ul>
<li>1、@Transactional 只能被应用到public方法上, 对于其它非public的方法,如果标记了@Transactional也不会报错,但方法没有事务功能.</li>
<li>2、用 spring 事务管理器,由spring来负责数据库的打开,提交,回滚.默认遇到运行期例外(throw new RuntimeException(“注释”);)会回滚，即遇到不受检查（unchecked）的例外时回滚；而遇到需要捕获的例外(throw new Exception(“注释”);)不会回滚,即遇到受检查的例外（就是非运行时抛出的异常，编译器会检查到的异常叫受检查例外或说受检查异常）时，需我们指定方式来让事务回滚要想所有异常都回滚,要加上 @Transactional( rollbackFor={Exception.class,其它异常}) .如果让unchecked例外不回滚： @Transactional(notRollbackFor=RunTimeException.class)</li>
<li>3、@Transactional 注解应该只被应用到 public 可见度的方法上。 如果你在 protected、private 或者 package-visible 的方法上使用 @Transactional 注解，它也不会报错， 但是这个被注解的方法将不会展示已配置的事务设置。</li>
<li>4、@Transactional 注解可以被应用于接口定义和接口方法、类定义和类的 public 方法上。然而，请注意仅仅 @Transactional 注解的出现不足于开启事务行为，它仅仅 是一种元数据，能够被可以识别 @Transactional 注解和上述的配置适当的具有事务行为的beans所使用。上面的例子中，其实正是 元素的出现 开启 了事务行为。</li>
<li>5、Spring团队的建议是你在具体的类（或类的方法）上使用 @Transactional 注解，而不要使用在类所要实现的任何接口上。你当然可以在接口上使用 @Transactional 注解，但是这将只能当你设置了基于接口的代理时它才生效。因为注解是不能继承的，这就意味着如果你正在使用基于类的代理时，那么事务的设置将不能被基于类的代理所识别，而且对象也将不会被事务代理所包装（将被确认为严重的）。因此，请接受Spring团队的建议并且在具体的类上使用 @Transactional 注解。</li>
</ul>
<h4 id="解决Transactional注解不回滚"><a href="#解决Transactional注解不回滚" class="headerlink" title="解决Transactional注解不回滚"></a>解决Transactional注解不回滚</h4><p>1、检查你方法是不是public的<br>2、你的异常类型是不是unchecked异常<br>如果我想check异常也想回滚怎么办，注解上面写明异常类型即可<br><code>@Transactional(rollbackFor=Exception.class) </code><br>类似的还有norollbackFor，自定义不回滚的异常<br>3、数据库引擎要支持事务，如果是MySQL，注意表要使用支持事务的引擎，比如innodb，如果是myisam，事务是不起作用的</p>

</article>
<ol class="animated rollIn hannah-toc"><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-3"><a class="animated rollIn hannah-toc-link" href="#Transactional"><span class="animated rollIn hannah-toc-text">@Transactional</span></a><ol class="animated rollIn hannah-toc-child"><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-4"><a class="animated rollIn hannah-toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="animated rollIn hannah-toc-text">实现</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-4"><a class="animated rollIn hannah-toc-link" href="#%E7%89%B9%E6%80%A7"><span class="animated rollIn hannah-toc-text">特性</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-4"><a class="animated rollIn hannah-toc-link" href="#Transactional%E6%B3%A8%E8%A7%A3%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3"><span class="animated rollIn hannah-toc-text">@Transactional注解参数详解</span></a><ol class="animated rollIn hannah-toc-child"><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-5"><a class="animated rollIn hannah-toc-link" href="#%E5%8F%82%E6%95%B0%E4%B8%80%EF%BC%9A%E4%BA%8B%E7%89%A9%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA-propagation"><span class="animated rollIn hannah-toc-text">参数一：事物传播行为 propagation</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-5"><a class="animated rollIn hannah-toc-link" href="#%E5%8F%82%E6%95%B0%E4%BA%8C%EF%BC%9A%E4%BA%8B%E7%89%A9%E8%B6%85%E6%97%B6%E8%AE%BE%E7%BD%AE-timeout"><span class="animated rollIn hannah-toc-text">参数二：事物超时设置 timeout</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-5"><a class="animated rollIn hannah-toc-link" href="#%E5%8F%82%E6%95%B0%E4%B8%89%EF%BC%9A%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB-isolation"><span class="animated rollIn hannah-toc-text">参数三：事务隔离级别 isolation</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-5"><a class="animated rollIn hannah-toc-link" href="#%E5%8F%82%E6%95%B0%E5%9B%9B%EF%BC%9AreadOnly"><span class="animated rollIn hannah-toc-text">参数四：readOnly</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-5"><a class="animated rollIn hannah-toc-link" href="#%E5%8F%82%E6%95%B0%E4%BA%94%EF%BC%9ArollbackFor"><span class="animated rollIn hannah-toc-text">参数五：rollbackFor</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-5"><a class="animated rollIn hannah-toc-link" href="#%E5%8F%82%E6%95%B0%E5%85%AD%EF%BC%9ArollbackForClassName"><span class="animated rollIn hannah-toc-text">参数六：rollbackForClassName</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-5"><a class="animated rollIn hannah-toc-link" href="#%E5%8F%82%E6%95%B0%E4%B8%83%EF%BC%9AnoRollbackForClassName"><span class="animated rollIn hannah-toc-text">参数七：noRollbackForClassName</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-5"><a class="animated rollIn hannah-toc-link" href="#%E5%8F%82%E6%95%B0%E5%85%AB%EF%BC%9AnoRollbackFor"><span class="animated rollIn hannah-toc-text">参数八：noRollbackFor</span></a></li></ol></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-4"><a class="animated rollIn hannah-toc-link" href="#%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="animated rollIn hannah-toc-text">注意点</span></a></li><li class="animated rollIn hannah-toc-item animated rollIn hannah-toc-level-4"><a class="animated rollIn hannah-toc-link" href="#%E8%A7%A3%E5%86%B3Transactional%E6%B3%A8%E8%A7%A3%E4%B8%8D%E5%9B%9E%E6%BB%9A"><span class="animated rollIn hannah-toc-text">解决Transactional注解不回滚</span></a></li></ol></li></ol>
<div class="animated bounceInDown paginations">
    <div class="col-md-8 col-md-push-2 col-xs-12">
        <nav>
            
            <a href="/2020/02/26/java-concurrent-synchronized-cas-lock/" class="prev col-md-2 col-xs-4 text-left">&larr; Prev</a>
            
            <span
                class="page-content col-md-8  col-xs-4 text-center">
                
            </span>
            
            <a href="/2020/01/28/java-memory-model/" class="next col-md-2 col-xs-4 text-right">Next &rarr;</a>
            
        </nav>
        <div>
            <div class="col-md-6 col-xs-6 text-left">
                
                java并发-synchronized关键字&CAS锁
                
            </div>
            <div class="col-md-6 col-xs-6 text-right">
                
                java-内存模型
                
            </div>
        </div>
    </div>
</div>

            <!--end body-->
            <!--begin comments-->
            
<div class="comments">
    

    
    
<div id="gitalk-container">
</div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script>
    var loadJs = function (d, a) {
        var c = document.getElementsByTagName("head")[0] || document.head || document
            .documentElement;
        var b = document.createElement("script");
        b.setAttribute("type", "text/javascript");
        b.setAttribute("src", d);
        if (typeof a === "function") {
            if (window.attachEvent) {
                b.onreadystatechange = function () {
                    var e = b.readyState;
                    if (e === "loaded" || e === "complete") {
                        b.onreadystatechange = null;
                        a()
                    }
                }
            } else {
                b.onload = a
            }
        }
        c.appendChild(b)
    };
    loadJs("https://unpkg.com/gitalk/dist/gitalk.min.js", function () {
        var gitalk = new Gitalk({
            clientID: '93363d527b7abfb071ed',
            clientSecret: 'e6d6ff61e51b30e6f838e4ca2e6626218f6dd468',
            repo: 'ilubov.github.io',
            owner: 'ilubov',
            admin: ['ilubov'],
            id: decodeURIComponent(location.pathname),
            distractionFreeMode: false
        })

        gitalk.render('gitalk-container')
    });
</script>

</div>


            <!--end comments-->
        </div>
    </div>

    <!--begin footer-->
    <footer id="footer" class="footer animated fadeInUp hide">
    <p><i class="copy">&copy;</i> 2021 <a href="http://yoursite.com">ilubov</a> All Right Reserved.</p>
    <p>Powered by <a target="_blank" href="http://hexo.io" rel="external nofollow noopener">Hexo</a>. Theme by <a target="_blank" href="https://github.com/objectyan/hexo-theme-hannah" rel="external nofollow noopener">hannah</a></p>
</footer>
    <!--end footer-->

    
    <!-- scripts list from theme config.yml -->
    
    <script src="/js/hannah.js"></script>
    
    
    <!--begin analytics-->
    
<script type="text/javascript">
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?8fb2a05be303b36faebf141d7317de43";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


    <!--end analytics-->
</body>
<!--end body-->
<!--begin canvas-nest-->
<script>
    var nesturl = "https://unpkg.com/canvas-nest.js/dist/canvas-nest.js";
    var c = document.getElementsByTagName("body")[0] || document.body || document.documentElement;
    var b = document.createElement("script");
    b.setAttribute("type", "text/javascript");
    b.setAttribute("src", nesturl);
    b.setAttribute("color",
        `${ Math.floor(Math.random()*256)},${ Math.floor(Math.random()*256)},${ Math.floor(Math.random()*256)}`);
    b.setAttribute("opacity", Math.random());
    b.setAttribute("count", parseInt((Math.random() * 500) || 99));
    c.appendChild(b)
</script>
<!--end canvas-nest-->

</html>